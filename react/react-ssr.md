# react中的服务端渲染

### 服务端渲染
页面向服务器请求，服务器直接渲染好html页面，并返回给客户端；页面交互需要通过引入js文件来实现,
```
 1. 向服务器请求页面，服务器通过计算，返回一个已经渲染好的html页面
 2. 请求js文件
 3. 运行js文件，绑定页面交互事件
```
 
### 客户端渲染
页面初始加载的html文件没有内容，需要通过js渲染生成页面，同时js绑定页面交互的事件，如我们经常写的spa应用都是客户端渲染
```
 1. 加载html文件
 2. 加载解析运行js文件，渲染页面（运行过程中可能涉及到ajax请求数据）,挂载事件也在渲染过程中进行
```
### react同构
同构就是客户端渲染和服务端渲染的结合，简单说就是，同一套js文件在服务端执行一次生成了html文件，服务器将html和js文件返回给客户端，客户端通过html渲染成页面，并通过js进行挂载事件；到达客户端之后，这个文件又变成了一个单页的应用，路由再次又客户端js接管。
```
 1. 向服务器请求页面，服务器通过计算，返回一个已经渲染好的html页面
 2. 请求js文件
 3. 运行js文件，绑定页面交互事件，
 4. 前端接管路由之后的操作相当于是客户端渲染
```

> #### 对比
> - 由于SSR返回的是一个完整的html页面，SEO能力要比客户端渲染效果好很多（搜索引擎不支持运行js）
> - 对于首屏加载速度SSR性能更优秀，由于SSR只需要发送一次请求就可以渲染出完整的页面，CSR需要至少请求两次（html和js）才能渲染出页面
> - SSR需要服务器承受更大的压力，当重新部署时，每次请求页面都需要服务器进行计算，可能造成计算资源的浪费


> #### 实现思路
> - 主体思路和传统的ssr一样，将js插入到一个html页面中，返回到前端
> - 服务端渲染通过react-dom提供的服务端渲染方法[renderToString](https://react.docschina.org/docs/react-dom-server.html#rendertostring)将jsx渲染成html，通过react-router-dom提供的[StaticRouter](https://reacttraining.com/react-router/web/api/StaticRouter) 来找到路由对应的页面
> - 在每个组件上增加一个客户端和服务器端都可以请求到数据的方法；并且在服务端渲染时，可以根据路由找到这个组件（函数或者类）然后请求数据，将请求到的数据通过windows插入到html文件中
> - 增加一个标识符可以确保在客户端渲染阶段，不会在首屏时进行客户端渲染（如果只是一个页面，不使用StaticRouter的情况下，标签上会有一个类似==data-reactroot==的属性以防止js再次渲染页面）

#### 我的demo
https://github.com/stevekak/react-app.git

